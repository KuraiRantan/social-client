<template>
	<nav class="nav">
		<div>
			<!-- <router-link
				class="link"
				:to="{ name: 'home' }"
				><i class="fa-brands fa-square-twitter fa-2xl"></i
			></router-link> -->
			<router-link
				class="link"
				:to="{ name: 'home' }"
			>
				<svg
					version="1.0"
					xmlns="http://www.w3.org/2000/svg"
					width="100%"
					height="20pt"
					viewBox="0 0 332.000000 56.000000"
					preserveAspectRatio="xMidYMid meet"
				>
					<g
						class="logo"
						transform="translate(0.000000,56.000000) scale(0.100000,-0.100000)"
						fill="#ff0000c9"
						stroke="none"
					>
						<path
							d="M203 544 c-8 -21 13 -42 28 -27 13 13 5 43 -11 43 -6 0 -13 -7 -17
-16z"
						/>
						<path
							d="M314 545 c-8 -20 4 -35 27 -35 14 0 19 7 19 25 0 18 -5 25 -20 25
-11 0 -23 -7 -26 -15z"
						/>
						<path
							d="M3025 538 c-3 -7 -4 -119 -3 -248 3 -227 4 -235 23 -235 18 0 20 8
23 63 3 60 4 63 43 89 l40 26 37 -30 c25 -20 45 -49 61 -91 18 -45 30 -62 43
-62 49 0 26 89 -42 163 l-49 54 57 39 c57 39 72 66 40 72 -9 2 -58 -24 -108
-58 -50 -33 -97 -63 -105 -66 -12 -5 -15 18 -17 142 -3 133 -5 149 -21 152 -9
2 -19 -3 -22 -10z"
						/>
						<path
							d="M806 509 c-57 -14 -92 -38 -115 -80 -20 -35 -21 -50 -19 -206 3 -155
4 -168 22 -171 10 -2 22 2 27 10 5 7 9 84 9 172 l0 158 34 34 c31 31 39 34 93
34 62 0 93 -14 115 -53 8 -14 15 -81 18 -187 l5 -165 25 0 25 0 3 148 c3 155
-5 208 -38 249 -38 49 -131 75 -204 57z"
						/>
						<path
							d="M2167 508 c-15 -8 -17 -30 -16 -191 1 -100 4 -193 8 -207 12 -43 62
-60 183 -60 120 0 138 4 138 31 0 18 -9 19 -119 19 -95 0 -123 3 -135 16 -13
13 -16 46 -16 204 0 196 -3 211 -43 188z"
						/>
						<path
							d="M2523 494 c-9 -24 10 -49 37 -49 31 0 48 28 31 49 -17 21 -60 21 -68
0z"
						/>
						<path
							d="M87 474 c-11 -12 -8 -41 6 -53 19 -15 50 9 45 35 -3 19 -38 31 -51
18z"
						/>
						<path
							d="M194 466 c-10 -26 4 -48 28 -44 33 4 33 52 0 56 -13 2 -25 -3 -28
-12z"
						/>
						<path
							d="M314 466 c-10 -26 4 -48 28 -44 33 4 33 52 0 56 -13 2 -25 -3 -28
-12z"
						/>
						<path
							d="M427 474 c-11 -12 -8 -41 6 -53 19 -15 50 9 45 35 -3 19 -38 31 -51
18z"
						/>
						<path
							d="M1167 360 c-55 -30 -77 -72 -77 -146 0 -107 61 -164 175 -164 94 1
180 49 146 83 -8 8 -23 5 -57 -12 -36 -18 -57 -22 -100 -19 -58 5 -104 35
-104 70 0 16 11 18 123 18 67 0 127 4 133 8 45 30 33 106 -23 149 -49 38 -158
44 -216 13z m190 -64 c13 -16 22 -33 20 -40 -2 -7 -43 -12 -115 -14 -127 -3
-137 4 -82 60 29 29 34 30 92 26 51 -4 65 -9 85 -32z"
						/>
						<path
							d="M1450 359 c0 -11 23 -46 50 -77 28 -31 50 -59 50 -63 0 -3 -25 -34
-55 -68 -58 -65 -66 -87 -38 -98 12 -5 32 10 74 55 55 60 74 72 81 53 7 -21
100 -111 114 -111 36 0 24 33 -35 100 l-62 69 56 61 c57 62 67 86 38 97 -12 5
-33 -11 -74 -55 l-58 -61 -51 59 c-54 62 -90 78 -90 39z"
						/>
						<path
							d="M1787 373 c-13 -12 -7 -213 7 -246 36 -85 128 -100 237 -40 4 2 9 -5
12 -17 3 -12 13 -20 26 -20 20 0 21 4 21 166 l0 165 -22 -3 c-22 -3 -23 -9
-29 -104 -4 -72 -10 -109 -23 -128 -33 -51 -111 -62 -151 -21 -23 22 -25 31
-25 124 0 55 -3 106 -6 115 -6 16 -35 22 -47 9z"
						/>
						<path
							d="M2534 367 c-2 -7 -3 -80 -2 -162 3 -137 5 -150 22 -153 10 -2 22 2
27 10 10 15 12 278 3 302 -7 19 -43 21 -50 3z"
						/>
						<path
							d="M2656 364 c-9 -24 -7 -287 3 -302 5 -8 17 -12 27 -10 17 3 20 16 24
103 3 55 11 110 18 122 29 52 123 70 158 32 16 -17 20 -42 24 -137 4 -104 7
-117 24 -120 29 -6 36 16 36 108 -1 113 -12 159 -50 193 -38 34 -111 37 -169
7 -39 -19 -39 -19 -44 0 -6 24 -42 27 -51 4z"
						/>
						<path
							d="M87 364 c-12 -13 -8 -52 7 -57 21 -8 49 16 44 39 -3 19 -38 31 -51
18z"
						/>
						<path
							d="M190 355 c-14 -17 -5 -51 16 -59 22 -8 54 11 54 32 0 38 -46 56 -70
27z"
						/>
						<path
							d="M306 354 c-10 -27 -7 -43 13 -54 11 -5 26 -7 35 -4 21 8 30 42 16 59
-16 20 -56 19 -64 -1z"
						/>
						<path
							d="M424 356 c-10 -26 4 -48 28 -44 33 4 33 52 0 56 -13 2 -25 -3 -28
-12z"
						/>
						<path
							d="M0 341 c0 -27 19 -36 37 -18 18 18 9 37 -18 37 -12 0 -19 -7 -19 -19z"
						/>
						<path
							d="M514 345 c-4 -10 -1 -21 7 -26 20 -12 34 -5 34 17 0 24 -33 31 -41 9z"
						/>
						<path
							d="M198 249 c-22 -12 -23 -42 -3 -59 32 -26 81 13 59 48 -14 21 -33 25
-56 11z"
						/>
						<path
							d="M310 245 c-26 -32 13 -81 48 -59 24 16 27 45 6 61 -23 17 -39 16 -54
-2z"
						/>
						<path
							d="M84 236 c-10 -26 4 -48 28 -44 17 2 23 10 23 28 0 18 -6 26 -23 28
-13 2 -25 -3 -28 -12z"
						/>
						<path
							d="M424 236 c-10 -26 4 -48 28 -44 17 2 23 10 23 28 0 18 -6 26 -23 28
-13 2 -25 -3 -28 -12z"
						/>
						<path
							d="M0 221 c0 -24 25 -34 40 -16 15 18 5 35 -21 35 -12 0 -19 -7 -19 -19z"
						/>
						<path
							d="M514 229 c-3 -6 0 -17 7 -25 18 -17 44 -2 36 20 -7 18 -33 21 -43 5z"
						/>
						<path
							d="M87 134 c-12 -13 -8 -52 7 -57 21 -8 49 16 44 39 -3 19 -38 31 -51
18z"
						/>
						<path
							d="M194 126 c-10 -26 4 -48 28 -44 33 4 33 52 0 56 -13 2 -25 -3 -28
-12z"
						/>
						<path
							d="M317 134 c-4 -4 -7 -18 -7 -31 0 -21 4 -24 28 -21 21 2 27 8 27 28 0
18 -6 26 -20 28 -12 2 -24 0 -28 -4z"
						/>
						<path
							d="M427 134 c-13 -13 -7 -52 8 -58 27 -10 46 5 43 33 -3 26 -35 41 -51
25z"
						/>
						<path
							d="M321 36 c-16 -19 -6 -36 20 -36 15 0 20 6 17 22 -4 27 -21 33 -37 14z"
						/>
						<path
							d="M200 20 c0 -13 7 -20 20 -20 13 0 20 7 20 20 0 13 -7 20 -20 20 -13
0 -20 -7 -20 -20z"
						/>
					</g>
				</svg>
			</router-link>
		</div>
		<div>
			<input
				class="search-input"
				type="search"
				name=""
				placeholder="Search..."
			/>
		</div>
		<ul class="list-links">
			<li><i class="fa-solid fa-bookmark fa-lg"></i></li>
			<li @click="manageNotification">
				<i
					:class="showNotification && 'icon-active'"
					class="fa-solid fa-bell fa-lg pointer"
					><span class="number-notification">{{
						getNoReadNotifications
					}}</span></i
				>
			</li>
			<li>
				<router-link
					class="link"
					:to="{ name: 'chat' }"
					><i class="fa-solid fa-message fa-lg"></i
				></router-link>
			</li>
			<li>
				<router-link
					class="link"
					:to="{
						name: 'profile',
						params: { username: `@${getUserLoged.username}` },
					}"
					><i class="fa-solid fa-user fa-lg"></i
				></router-link>
			</li>
			<li><i class="fa-solid fa-user-gear fa-lg"></i></li>
			<li><button @click="logout">logout</button></li>
		</ul>
	</nav>
	<Notification
		v-if="showNotification"
		:notifications="getNotifications"
	/>
</template>

<script>
import { mapActions, mapGetters, mapMutations } from 'vuex';
import Notification from '@/shared/components/Notification.vue';
export default {
	components: {
		Notification: Notification,
	},
	data() {
		return {
			showNotification: false,
		};
	},
	computed: {
		...mapGetters('user', ['getNotifications', 'getUserLoged']),
		getNoReadNotifications() {
			return this.getNotifications.reduce(
				(acc, value) => (value.read ? acc : acc + 1),
				0
			);
		},
	},
	watch: {
		showNotification() {
			(function () {
				if (this.showNotification) {
					setTimeout(() => {
						const pendingNotifications =
							this.getNotifications?.filter(
								n => n.read === false
							);
						if (pendingNotifications?.length > 0)
							this.fetchReadNotifications(pendingNotifications);
					}, 5000);
				}
			}).bind(this)();
		},
	},
	methods: {
		...mapMutations('user', ['LOGOUT']),
		...mapMutations('socket', ['disconnectSocket']),
		...mapActions('user', ['fetchReadNotifications']),
		logout() {
			this.disconnectSocket();
			this.LOGOUT();
			this.$router.push({ name: 'auth-login' });
		},
		manageNotification() {
			this.showNotification = !this.showNotification;
		},
	},
};
</script>

<style scoped>
.nav {
	display: flex;
	justify-content: space-between;
	align-items: center;
	padding: 10px;
	position: sticky;
	top: 0;
	background-color: white;
	z-index: 100;
}

.list-links {
	list-style: none;
	margin: 0;
	padding: 0;
	display: flex;
	column-gap: 20px;
}

.search-input {
	padding: 5px 10px;
	width: 100%;
	border-radius: 20px;
	border: 0.2px solid gray;
	outline: none;
}

.link {
	color: inherit;
}

.link:hover {
	color: blue;
}

.router-link-exact-active {
	color: blue;
}

.router-link-exact-active .logo {
	fill: blue;
}

.logo {
	height: 20px;
}

.icon-active {
	color: brown;
}

.pointer:hover {
	cursor: pointer;
	color: brown;
}

.number-notification {
	font-size: 10px;
	display: inline-block;
	margin-left: 3px;
	color: green;
	user-select: none;
}
</style>
